# E2E 测试规范 (Playwright MCP)

## 目录
- [测试策略](#测试策略)
- [Playwright MCP 使用](#playwright-mcp-使用)
- [测试场景](#测试场景)
- [最佳实践](#最佳实践)

---

## 测试策略

### 验证层级
| 层级 | 方式 | 工具 |
|------|------|------|
| E2E 验证 | 浏览器自动化 | Playwright MCP |
| 可视化验证 | 截图对比 | Playwright MCP |
| 交互验证 | 用户行为模拟 | Playwright MCP |

### 优先使用 E2E 而非单元测试
- 前端组件优先进行 E2E 验证
- 确保真实浏览器环境下的行为
- 验证完整用户流程

---

## Playwright MCP 使用

### 启动浏览器
```
使用 Playwright MCP 工具:
- browser_navigate: 导航到指定 URL
- browser_screenshot: 截取页面截图
- browser_click: 点击元素
- browser_type: 输入文本
- browser_snapshot: 获取页面状态
```

### 常用操作

#### 导航和截图
```
1. browser_navigate → 打开目标页面
2. browser_screenshot → 截取初始状态
3. 进行交互操作
4. browser_screenshot → 截取结果状态
```

#### 表单交互
```
1. browser_navigate → 打开表单页面
2. browser_type → 填写表单字段
3. browser_click → 点击提交按钮
4. browser_snapshot → 验证结果
```

#### 元素验证
```
1. browser_snapshot → 获取页面 DOM
2. 检查元素是否存在
3. 验证元素内容和属性
```

---

## 测试场景

### 组件渲染验证
```
场景：验证 Card 组件渲染
步骤：
1. 导航到组件演示页面
2. 截取页面截图
3. 验证组件可见性
4. 检查样式是否正确应用
```

### 用户交互验证
```
场景：验证表单提交
步骤：
1. 导航到表单页面
2. 填写 Name 字段
3. 填写 Email 字段
4. 点击 Submit 按钮
5. 验证成功提示显示
```

### 响应式布局验证
```
场景：验证移动端适配
步骤：
1. 设置视口为移动端尺寸 (375x667)
2. 导航到目标页面
3. 截取截图
4. 验证布局正确
```

### 状态变化验证
```
场景：验证 Loading 状态
步骤：
1. 导航到列表页面
2. 截取 Loading 状态截图
3. 等待数据加载
4. 截取 Loaded 状态截图
5. 验证数据显示正确
```

---

## 最佳实践

### 测试粒度
| 推荐 | 不推荐 |
|------|--------|
| 完整用户流程 | 孤立的 DOM 操作 |
| 关键交互路径 | 每个样式属性 |
| 核心业务功能 | 内部实现细节 |

### 选择器策略
```
优先级（从高到低）：
1. data-testid 属性
2. ARIA 角色和标签
3. 可见文本内容
4. CSS 类名（最后选择）
```

### 等待策略
```
推荐：
- 等待元素可见
- 等待网络请求完成
- 等待动画结束

避免：
- 固定时间等待 (sleep)
- 轮询检查
```

### 截图命名
```
格式：{页面}-{状态}-{时间戳}
示例：
- login-initial-20250108
- login-filled-20250108
- login-success-20250108
```

---

## 验证清单

### 组件验证
- [ ] 组件正确渲染
- [ ] Props 正确传递
- [ ] 交互响应正常
- [ ] 样式正确应用

### 页面验证
- [ ] 路由正确导航
- [ ] 数据正确加载
- [ ] 错误状态处理
- [ ] Loading 状态显示

### 表单验证
- [ ] 输入正确填写
- [ ] 验证规则生效
- [ ] 提交正常工作
- [ ] 错误提示显示

### 响应式验证
- [ ] 桌面端布局正确
- [ ] 平板端布局正确
- [ ] 移动端布局正确
- [ ] 断点切换正常
